"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},__assign.apply(this,arguments)},__rest=this&&this.__rest||function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r},__spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var i,n=0,a=e.length;n<a;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setConfig=exports.DataForm=exports.errorOnField=exports.isObject=exports.Input=exports.DefaultInputContainer=exports.makeInputField=exports.notEmpty=exports.inputClass=exports.inputClassWithoutWidth=exports.deepEqual=void 0;var jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),react_with_native_1=require("react-with-native"),react_with_native_ui_1=require("react-with-native-ui");Object.defineProperty(exports,"inputClass",{enumerable:!0,get:function(){return react_with_native_ui_1.inputClass}});var react_2=__importDefault(require("fast-deep-equal/react"));exports.deepEqual=react_2.default;var inputClassWithoutWidth=react_with_native_ui_1.bareInputClass;exports.inputClassWithoutWidth=inputClassWithoutWidth;var isWeb="undefined"!=typeof window&&!!window.scrollTo,sameFieldArray=function(t,e){var r=t.map((function(t){t.shouldHide,t.titleFromState,t.hasError;return __rest(t,["shouldHide","titleFromState","hasError"])})),i=e.map((function(t){t.shouldHide,t.titleFromState,t.hasError;return __rest(t,["shouldHide","titleFromState","hasError"])}));
// console.log({ simpleArr1, simpleArr2, isDeepEqual });
return(0,react_2.default)(r,i)};function notEmpty(t){return null!=t}exports.notEmpty=notEmpty;var makeInputField=function(t,e){return function(){return __assign({type:t},e)}};exports.makeInputField=makeInputField;var GLOBAL_PROPERTY_PATH="__GLOBAL__",DefaultInputContainer=function(t){var e=t.children,r=t.startSection,i=t.sectionTitle,n=t.title,a=t.description,s=t.error,o=t.errorClassName;return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[r?(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({style:{display:"flex",height:40,justifyContent:"center",paddingLeft:10}},{children:i?(0,jsx_runtime_1.jsx)(react_with_native_1.P,{children:(0,jsx_runtime_1.jsx)(react_with_native_1.Strong,{children:i})}):(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{style:{height:40}})})):null,(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"pt-0 mb-6",style:{marginBottom:10}},{children:[n?(0,jsx_runtime_1.jsx)(react_with_native_1.Label,__assign({className:"mb-2 text-sm font-bold"},{children:n})):null,a&&(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"flex mx-3 mb-2 items-start "},{children:(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:"text-gray-500 italic"},{children:a}))})),s?(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:o||"mr-3 mb-2 text-red-500"},{children:s||"Invalid value"})):null,(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{children:e})]}))]})};exports.DefaultInputContainer=DefaultInputContainer;var getPlugin=function(t,e){return t?e[t]:e[Object.keys(e)[0]]},Input=function(t){var e,r=t.type,i=t.plugin,n=t.title,a=t.onChange,s=t.value,o=t.isLast,l=t.startSection,u=t.sectionTitle,_=t.next,c=t.extra,d=t.errors,f=t.reference,p=t.description,m=t.config,v=t.uniqueFieldId,h=t.renderInputContainer,x=t.errorClassName,g=t.fieldName,j=i,y=h||exports.DefaultInputContainer;return(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({ref:f},{children:(0,jsx_runtime_1.jsx)(y,__assign({},{description:p,sectionTitle:u,startSection:l,title:n,next:_,isLast:o,id:v,type:r,error:!i.hideContainerError&&(null===(e=null==d?void 0:d.find((0,exports.errorOnField)(g)))||void 0===e?void 0:e.message),extra:c,config:m,errorClassName:x},{children:(0,jsx_runtime_1.jsx)(j,__assign({},{uniqueFieldId:v,fieldName:g,config:m,extra:c,onChange:a,value:s,errors:d,errorClassName:x}))}))}))};exports.Input=Input;var DefaultTitle=function(t){var e=t.title,r=t.backButton;return e?(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"flex items-center mb-10 "},{children:[r&&(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({onClick:r,className:"p-4 cursor-pointer"},{children:"back"})),(0,jsx_runtime_1.jsx)(react_with_native_1.H2,__assign({className:"text-2xl font-bold"},{children:e}))]})):null};function isObject(t){return null!=t&&"object"==typeof t}exports.isObject=isObject;var errorOnField=function(t){return function(e){return e.propertyPath===t||e.propertyPath.startsWith(t+".")}};exports.errorOnField=errorOnField;var DataForm=function(t){
//sometimes use defaultValues (deprecated)
var e,r,i=t.fields,n=t.defaultValues,a=t.initialValues,s=t.onSubmit,o=t.withSubmitProps,l=t.noSubmit,u=t.submitButtonText,_=t.submitButtonColor,c=t.title,d=t.backButton,f=t.plugins,p=t.renderSubmitComponent,m=t.renderInputContainer,v=t.stickySubmit,h=t.renderTitle,x=t.submitClassName,g=t.errorClassName,j=t.successClassName;if(a=a||n,!f)throw new Error("No plugins given");
//Generate unique id for the form
var y=(0,react_1.useState)("Form".concat(String(Math.round(1e6*Math.random()))))[0],w=(0,react_1.useState)([]),b=w[0],C=w[1],P=(0,react_1.useState)([]),O=P[0],S=P[1];(0,react_1.useEffect)((function(){var t=i.map((function(t){return t()}));sameFieldArray(t,O)||(C(t.map((function(t){return __assign(__assign({},t),{reference:(0,react_1.createRef)()})}))),S(t))}),[i]);var F=i.reduce((function(t,e){var r,i=e().type,n=getPlugin(i,f).component.defaultInitialValue,a=e().initialValue,s=e().field,o=void 0!==a?a:void 0!==n?n:void 0;return __assign(__assign({},t),((r={})[s]=o,r))}),{}),D=__assign(__assign({},F),a),A=(0,react_1.useState)(D),I=A[0],N=A[1],E=(0,react_1.useState)(),T=E[0],B=E[1];(0,react_1.useEffect)((function(){T&&(0,react_2.default)(D,T)||(
// console.log("initialValues have changed");
N(D),B(D))}),[D]);var L=(0,react_1.useState)(!1),W=L[0],k=L[1],H=(0,react_1.useState)([]),R=H[0],q=H[1],Y=(0,react_1.useState)(),G=Y[0],M=Y[1],V=b.filter((function(t){var e,r;return!(null===(e=t.shouldHide)||void 0===e?void 0:e.call(t,I))&&(null===(r=t.hasError)||void 0===r?void 0:r.call(t,I[t.field],I))})),z=null===(r=null===(e=V[0])||void 0===e?void 0:e.reference)||void 0===r?void 0:r.current;function J(t){var e,r=i.reduce((function(e,r){var i,n,a,s,o=!(null===(n=(i=r()).shouldHide)||void 0===n?void 0:n.call(i,t)),l=null===(s=(a=r()).hasError)||void 0===s?void 0:s.call(a,t[r().field],t),u=o&&l,_="string"==typeof u?[{propertyPath:r().field,message:u}]:Array.isArray(u)?u:[];return __spreadArray(__spreadArray([],e,!0),_,!0)}),[]);
if(q(r),0===(null==r?void 0:r.length))
//no errors
k(!0),s(t,(function(t){M(t),k(!1)}),(function(t){!function(t){var e,r,n,a;if(t){
//if the rejection provides a string, just return an array with 1 element: that string, on the global property path
//however, if it's an error array, return that. But make sure that if the propertyPath doesn't exist, it's still rendered globally.
var s="string"==typeof t?[{propertyPath:GLOBAL_PROPERTY_PATH,message:t}]:t.map((function(t){var e=t.propertyPath;return{message:t.message,propertyPath:i.map((function(t){return t().field})).find((function(t){return e===t||e.startsWith("".concat(t,"."))}))?e:GLOBAL_PROPERTY_PATH}}));
//this only happens when there are no frontend errors, so it's safe to replace errors
q(s);
//scroll to the first field that contains an error
var o=b.filter((function(t){return void 0!==s.find((0,exports.errorOnField)(t.field))}))[0];if(isWeb){var l=((null===(n=null===(r=null===(e=null==o?void 0:o.reference)||void 0===e?void 0:e.current)||void 0===r?void 0:r.getBoundingClientRect)||void 0===n?void 0:n.call(r).top)||0)+(window.scrollY||0)-100;
// console.log("setErrorsReject: scrolling to first error field");
null===(a=window.scrollTo)||void 0===a||a.call(window,{top:l,behavior:"smooth"})}}}(t),k(!1)}));else
//scroll to the error
/// onError("Please fill in all fields correctly");
if(isWeb){var n=((null==z?void 0:z.getBoundingClientRect().top)||0)+window.scrollY-100;
// console.log("onClickSubmit: scrolling to first error field");
null===(e=window.scrollTo)||void 0===e||e.call(window,{top:n,behavior:"smooth"})}}var K=!W&&0===V.length,Q={loading:W,available:K,submitButtonText:u,submitButtonColor:_,
//should be overwritten on state change
onSubmit:function(){return J(I)},state:I};(0,react_1.useEffect)((function(){
//console.log({ withSubmitProps: submitProps });
null==o||o(Q)}),[W,K,u,_,z]);var U=h||DefaultTitle,X=function(){return l?null:p?p(Q):(0,jsx_runtime_1.jsxs)(react_with_native_1.Button,__assign({disabled:W,className:"".concat(K?"".concat(_||"bg-green-500"):"bg-gray-300","  flex justify-center flex-row w-full px-4 py-2 text-sm font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"),onClick:function(){return J(I)},
//......Extra
style:{backgroundColor:"#4ade80",color:"white",width:"100%",marginTop:5,marginBottom:5,display:"flex",justifyContent:"center",borderRadius:10,alignItems:"center",borderColor:"white",padding:8}},{children:[W?(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"mr-2"},{children:(0,jsx_runtime_1.jsx)(react_with_native_1.ActivityIndicator,{})})):null,(0,jsx_runtime_1.jsx)(react_with_native_1.Label,__assign({style:{color:"white",fontWeight:"bold"}},{children:u||"Save"}))]}))},Z=null==R?void 0:R.find((function(t){return t.propertyPath===GLOBAL_PROPERTY_PATH}));return(0,jsx_runtime_1.jsxs)(react_with_native_1.Form,__assign({className:"w-full",onSubmit:function(t){t.preventDefault(),J(I)}},{children:[(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"w-full"},{children:[(0,jsx_runtime_1.jsx)(U,{title:c,backButton:d}),G?(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:j},{children:G})):null,Z?(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:g||"text-red-600"},{children:Z.message})):null,b.map((function(t,e){var r,n,a=getPlugin(t.type,f);
// Take the first plugin if the plugin isn't defined.
if(!a)return(0,jsx_runtime_1.jsxs)(react_with_native_1.P,{children:["Plugin not found (",t.field,", ",t.type,")"]});var s=null===(r=i[e+1])||void 0===r?void 0:r.call(i),l="".concat(y||"",".").concat(t.field),u=R.filter((function(e){return e.propertyPath===t.field||e.propertyPath.startsWith("".concat(t.field,"."))}));return(null===(n=t.shouldHide)||void 0===n?void 0:n.call(t,I))?null:(0,jsx_runtime_1.jsx)(exports.Input,{fieldName:t.field,renderInputContainer:m,uniqueFieldId:l,config:a.config,plugin:a.component,extra:t.extra,reference:t.reference,next:s,type:t.type,title:t.titleFromState?t.titleFromState(I):t.title,value:I[t.field],onChange:function(e){return function(r){var i,n,a=((i={})[t.field]=r,i),s=__assign(__assign({},e),a),l=R.filter((0,exports.errorOnField)(t.field)),u=null===(n=t.hasError)||void 0===n?void 0:n.call(t,r,s),_="string"==typeof u?1:Array.isArray(u)?u.length:0;if(l.length>0&&_!==l.length){var c=R.filter((function(e){return!(0,exports.errorOnField)(t.field)(e)})),d="string"==typeof u?[{message:u,propertyPath:t.field}]:Array.isArray(u)?u:[];q(__spreadArray(__spreadArray([],c,!0),d,!0))}N(s),
//NB: make sure to add the new state to the submitprops
null==o||o(__assign(__assign({},Q),{state:s,onSubmit:function(){return J(s)}}))}}(I),isLast:e===(null==i?void 0:i.length)-1,startSection:t.startSection,sectionTitle:t.sectionTitle,description:t.description,errors:u},"field-".concat(t.field))}))]})),X?(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"".concat(v?"sticky bottom-0":""," ").concat(x||"mb-2 py-2")},{children:(0,jsx_runtime_1.jsx)(X,{})})):null]}))};exports.DataForm=DataForm;var setConfig=function(t,e){return function(r){return(0,jsx_runtime_1.jsx)(t,__assign({},e,r))}};exports.setConfig=setConfig;
//# sourceMappingURL=general.js.map