"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},__assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TableRow=exports.TableHeadItem=exports.Table=exports.useIsInViewport=exports.getColumns=void 0;var jsx_runtime_1=require("react/jsx-runtime"),react_with_native_1=require("react-with-native"),convert_case_1=require("convert-case"),js_util_1=require("js-util"),schema_util_1=require("schema-util"),react_1=require("react"),tdClassName="whitespace-nowrap py-4 pr-3 text-sm first-of-type:font-medium text-gray-500 dark:text-gray-200 first-of-type:text-gray-900 first-of-type:dark:text-gray-100 first-of-type:sm:pl-6 first-of-type:md:pl-0",getColumns=function(e,t,r){var n,s,a=function(){return r[0]&&"object"==typeof r[0]?Object.keys(r[0]).map((function(e){var t=r[0][e];return["string","boolean","number","null"].includes(typeof t)?{name:(0,convert_case_1.humanCase)(e),objectParameterKey:e,presentationType:"text"}:null})).filter(js_util_1.notEmpty):[]};
/**
     * needed in case something goes wrong with the index
     */if(!t)return a();var i=null===(s=null===(n=t.find((function(t){return t.name===e})))||void 0===n?void 0:n.type.typeDefinition)||void 0===s?void 0:s.properties;return i?Object.keys(i).map((function(e){var t=i[e],r="boolean"!=typeof t?t:void 0;if(r&&!(0,js_util_1.makeArray)(r.type).find((function(e){return["object","array"].includes(e)})))return{name:(0,convert_case_1.humanCase)(e),objectParameterKey:e,presentationType:"text"}})).filter(js_util_1.notEmpty):a()};function useIsInViewport(e){var t=(0,react_1.useState)(!1),r=t[0],n=t[1],s=(0,react_1.useMemo)((function(){return new IntersectionObserver((function(e){var t=e[0];return n(t.isIntersecting)}))}),[]);return(0,react_1.useEffect)((function(){if(e.current)return s.observe(e.current),function(){s.disconnect()}}),[e,s]),r}exports.getColumns=getColumns,exports.useIsInViewport=useIsInViewport;var Table=function(e){var t=e.data,r=e.columns,n=e.renderExtraColumns,s=e.extraColumnsAtStart,a=e.onEndReached,i=e.shouldHighlightItem,o=(0,react_1.useRef)(null),l=useIsInViewport(o);return(0,react_1.useEffect)((function(){console.log("END REACHED"),null==a||a()}),[l]),(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"px-4 sm:px-6 lg:px-8"},{children:(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"mt-8 flex flex-col"},{children:(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8"},{children:(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8"},{children:[(0,jsx_runtime_1.jsxs)("table",__assign({className:"min-w-full divide-y divide-gray-300"},{children:[(0,jsx_runtime_1.jsx)("thead",{children:(0,jsx_runtime_1.jsxs)("tr",{children:[s?(0,jsx_runtime_1.jsx)(exports.TableHeadItem,{name:"",objectParameterKey:""}):null,r.map((function(e,t){
// NB: here we are destructuring column to provide all the props to a component
return(0,jsx_runtime_1.jsx)(exports.TableHeadItem,__assign({},e))})),n&&!s?(0,jsx_runtime_1.jsx)(exports.TableHeadItem,{objectParameterKey:"",name:""}):null]})}),(0,jsx_runtime_1.jsx)("tbody",__assign({className:"divide-y divide-gray-200"},{children:t?// If data is undefined, we have to render the skelletonview
t.map((function(e,t){var a=null==i?void 0:i(e);return(0,jsx_runtime_1.jsx)(exports.TableRow,{shouldHighlight:a,row:e,columns:r,renderExtraColumns:n,extraColumnsAtStart:s},"row".concat(t))})):// Without data we are assuming it's still loading and show 10 skelletons, which are simply TableRow's without any data
[0,1,2,3,4,5,6,7,8,9].map((function(e,t){return(0,jsx_runtime_1.jsx)(exports.TableRow,{row:void 0,columns:r},"skeleton".concat(t))}))}))]})),(0,jsx_runtime_1.jsx)("div",__assign({ref:o},{children:"Â "}))]}))}))}))}))};exports.Table=Table;var TableHeadItem=function(e){return(0,jsx_runtime_1.jsx)("th",__assign({scope:"col",className:"whitespace-nowrap py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6 md:pl-0"},{children:(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{children:e.name})}))};exports.TableHeadItem=TableHeadItem;var Skeleton=function(){return(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:(0,jsx_runtime_1.jsx)("div",{className:"bg-gray-200 w-full p-2 animate-pulse rounded-lg h-5"})}))},renderColumn=function(e,t,r){if("text"===e.presentationType){var n=t[e.objectParameterKey],s=void 0===n?"":""===n?"''":String(n);
/**
         * This is a text item that presents just one string
         */
return(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:s}))}if("referenceSingle"===e.presentationType){
// Any parameter with pattern xxxSlug or xxxId should link to that instance in the referred model (link to `db?model={model}#{id}`)
var a=t[e.objectParameterKey],i=(0,schema_util_1.getReferenceParameterInfo)(e.objectParameterKey);return(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:(0,jsx_runtime_1.jsx)("a",__assign({href:"db?model=".concat(i.interfaceName,"&").concat(i.keyInModel,"=").concat(a)},{children:a}))}))}if("referenceMultiple"===e.presentationType){
// Any parameter with pattern xxxSlugs or xxxIds should link to those instance in the referred model (link to `db?model={model}&xxx={id}`) for every instance
// NB: it can also be a string in case markdown storage format is used, if there is just one...
var o=t[e.objectParameterKey],l=o?(0,js_util_1.makeArray)(o):void 0,u=(0,schema_util_1.getReferenceParameterInfo)(e.objectParameterKey);return(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:null==l?void 0:l.map((function(e){return(0,jsx_runtime_1.jsx)("a",__assign({href:"db?model=".concat(u.interfaceName,"&").concat(u.keyInModel,"=").concat(e)},{children:e}))}))}))}return(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:"Unknown Presentation Type"}))},TableRow=function(e){var t=e.row,r=e.columns,n=e.renderExtraColumns,s=e.extraColumnsAtStart,a=e.shouldHighlight;
/**
     * Check which presentation type is set for this column and return this component
     */return(0,jsx_runtime_1.jsxs)("tr",__assign({className:a?"bg-blue-300":void 0},{children:[s&&(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:null==n?void 0:n(t)})),r.map((function(e,r){return t?
// we can optionally have a custom presentation for any column
e.customPresentation?e.customPresentation(t):renderColumn(e,t,r):(0,jsx_runtime_1.jsx)(Skeleton,{})})),!s&&(0,jsx_runtime_1.jsx)("td",__assign({className:tdClassName},{children:null==n?void 0:n(t)}))]}))};exports.TableRow=TableRow;
//# sourceMappingURL=Table.js.map