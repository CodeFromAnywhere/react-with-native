"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFolderExplorationDetails=void 0;var path_util_1=require("path-util"),fs_util_1=require("fs-util"),get_path_1=require("get-path"),read_markdown_file_1=require("read-markdown-file"),read_typescript_file_1=require("read-typescript-file"),database_1=require("database"),get_path_2=require("get-path"),getFolderExplorationDetails=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,r,a,n,i,o,s,l,u,c,p,d,_,f,h,g,b,y,v,x,m,w,F;return __generator(this,(function(D){switch(D.label){case 0:return t=e.name,r=e.path,a=e.type,n=e.hasCommentTypes,i=e.interfaceIsDbModel,o=e.sort,s=e.typeIndexType,(l=(0,get_path_2.getProjectRoot)())||(console.log("getFolderExplorationDetails: Projectroot not found"),process.exit(1)),u=fs_util_1.path.join(l,r),c=(0,get_path_1.findOperationBasePath)(u),p=c?(0,fs_util_1.getLastFolder)(c):void 0,[4/*yield*/,database_1.db.get("TsInterface",{operationName:"code-types"})];case 1:return d=D.sent().filter((function(e){return"src/FolderExploration.ts"===e.operationRelativeTypescriptFilePath})),(_=["folder","operation","operationFolder","typescript"].includes(a))?[4/*yield*/,(0,path_util_1.calculatePathMetaData)(u)]:[3/*break*/,3];case 2:return h=D.sent(),[3/*break*/,4];case 3:h=void 0,D.label=4;case 4:return f=h,g=!!p&&u!==c,_&&void 0!==s?[4/*yield*/,(0,read_typescript_file_1.getFolderTypescriptIndex)({filePath:g?u:void 0,basePath:g?void 0:u,filter:{hasCommentTypes:n,interfaceIsDbModel:i},sort:o,type:s})]:[3/*break*/,6];case 5:return y=D.sent(),[3/*break*/,7];case 6:y=null,D.label=7;case 7:return b=y,"folder"!==a?[3/*break*/,8]:[2/*return*/,__assign(__assign({index:d},b),{pathMetaData:f})];case 8:return"operationFolder"!==a?[3/*break*/,9]:[2/*return*/,__assign(__assign({index:d},b),{pathMetaData:f})];case 9:return"operation"===a&&c?[2/*return*/,__assign(__assign({index:d},b),{pathMetaData:f})]:[3/*break*/,10];case 10:return"markdown"!==a?[3/*break*/,12]:(v=fs_util_1.path.join(l,r),[4/*yield*/,(0,read_markdown_file_1.readMarkdownFile)(v)]);case 11:return x=D.sent(),[2/*return*/,{index:d,markdown:x||void 0,success:!!x,response:x?void 0:"reading markdown file failed"}];case 12:return"typescript"!==a?[3/*break*/,13]:[2/*return*/,__assign(__assign({},b||{success:!1,response:"reading typescript file failed"}),{index:d,pathMetaData:f})];case 13:return"function"!==a?[3/*break*/,15]:[4/*yield*/,database_1.db.get("TsFunction",{operationName:p})];case 14:return[2/*return*/,{tsFunctions:(m=D.sent().find((function(e){return e.name===t})))?[m]:void 0,index:d}];case 15:return"interface"!==a?[3/*break*/,17]:[4/*yield*/,database_1.db.get("TsInterface",{operationName:p})];case 16:return[2/*return*/,{tsInterfaces:(w=D.sent().find((function(e){return e.name===t})))?[w]:void 0,index:d}];case 17:return"variable"!==a?[3/*break*/,19]:[4/*yield*/,database_1.db.get("TsVariable",{operationName:p})];case 18:return[2/*return*/,{tsVariables:(F=D.sent().find((function(e){return e.name===t})))?[F]:void 0,index:d}];case 19:
// Should never happen if all ifs  return....
return[2/*return*/,{index:d,success:!1,response:"getFolderExplorationDetails: Couldn't understand your input: ".concat(JSON.stringify({path:r,type:a,name:t}))}]}}))}))};exports.getFolderExplorationDetails=getFolderExplorationDetails;
//# sourceMappingURL=getFolderExplorationDetails.js.map