"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}u((o=o.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,o,s,r,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(s=2&r[0]?o.return:r[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,r[1])).done)return s;switch(o=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(s=l.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){l=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){l.label=r[1];break}if(6===r[0]&&l.label<s[1]){l.label=s[1],s=r;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(r);break}s[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var common_types_1=require("common-types"),fs_orm_1=require("fs-orm"),db=(0,fs_orm_1.createDb)({defaultDbStorageMethods:{CsvTestModel:"csv",JsonMultipleTestModel:"jsonMultiple",JsonSingleTestModel:"jsonSingle",MarkdownTestModel:"markdown",KeyValueMarkdownTestModel:"keyValueMarkdown"}}),generateCsvInstance=function(){var e=Date.now();return{id:(0,common_types_1.generateId)(),age:23,name:"test",createdAt:e,updatedAt:e,createdFirstAt:e,deletedAt:0,description:"test"}},generateKvmdInstance=function(){return{id:"2",categoryStack:["Header1","Subheader"],comment:"comment",value:"value",name:"Key",slug:"key-slug",index:0,relativeIndex:0}},testCsv=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,t,n,o,s,r,l,a,u,d,c,i,g,v,p;return __generator(this,(function(f){switch(f.label){case 0:return e=generateCsvInstance(),t=e.id,e.age,[4/*yield*/,db.set("CsvTestModel",[e])];case 1:return n=f.sent(),console.log({setResult:n}),[4/*yield*/,db.get("CsvTestModel")];case 2:return o=f.sent(),console.log({getResult:o}),1!==o.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.push("CsvTestModel",generateCsvInstance())];case 3:return s=f.sent(),console.log({pushResult:s}),[4/*yield*/,db.get("CsvTestModel")];case 4:return r=f.sent(),console.log({getResult2:r}),2!==r.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.remove("CsvTestModel",(function(e){return e.id!==t}))];case 5:return l=f.sent(),console.log({removeResult:l}),1!==l.amountRemoved&&(console.log("Invalid amount removed"),process.exit(1)),[4/*yield*/,db.get("CsvTestModel")];case 6:return a=f.sent(),console.log({getResult3:a}),1!==a.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.update("CsvTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e),{age:50})}))];case 7:return u=f.sent(),console.log({updateResult:u}),1!==u.rowsUpdated&&(console.log("Invalid rows updated",{firstId:t,updateResult:u.data}),process.exit(1)),50!==(null===(v=u.data)||void 0===v?void 0:v[0].age)&&(console.log({firstItem:null===(p=u.data)||void 0===p?void 0:p[0]},"age should be 50"),process.exit(1)),[4/*yield*/,db.get("CsvTestModel")];case 8:return d=f.sent(),console.log({getResult4:d}),1!==d.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.upsert("CsvTestModel",(function(e){return e.id===(0,common_types_1.generateId)()}),(function(e){return generateCsvInstance()}))];case 9:return c=f.sent(),console.log({upsertResult:c}),[4/*yield*/,db.upsert("CsvTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e||generateCsvInstance()),{name:"upsert updated name"})}))];case 10:return i=f.sent(),console.log({upsert2Result:i}),[4/*yield*/,db.get("CsvTestModel")];case 11:return g=f.sent(),console.log({getResult5:g}),2!==g.length&&(console.log("Invalid length"),process.exit(1)),console.log("Csv Test Succeeded!"),[2/*return*/,!0]}}))}))},testKvmd=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,t,n,o,s,r,l,a,u,d,c,i,g,v,p,f;return __generator(this,(function(h){switch(h.label){case 0:return e=generateKvmdInstance(),t=e.id,[4/*yield*/,db.set("KeyValueMarkdownTestModel",[e])];case 1:return n=h.sent(),console.log({setResult:n}),[4/*yield*/,db.get("KeyValueMarkdownTestModel")];case 2:return o=h.sent(),console.log({getResult:o}),1!==o.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.push("KeyValueMarkdownTestModel",generateKvmdInstance())];case 3:return s=h.sent(),console.log({pushResult:s}),[4/*yield*/,db.get("KeyValueMarkdownTestModel")];case 4:return r=h.sent(),console.log({getResult2:r}),2!==r.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.remove("KeyValueMarkdownTestModel",(function(e){return e.id!==t}))];case 5:return l=h.sent(),console.log({removeResult:l,firstId:t}),1!==l.amountRemoved&&(console.log("Invalid amount removed"),process.exit(1)),[4/*yield*/,db.get("KeyValueMarkdownTestModel")];case 6:return a=h.sent(),console.log({getResult3:a}),1!==a.length&&(console.log("Invalid length"),process.exit(1)),u="new value (updated)",[4/*yield*/,db.update("KeyValueMarkdownTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e),{value:u})}))];case 7:return d=h.sent(),console.log({updateResult:d}),1!==d.rowsUpdated&&(console.log("Invalid rows updated",{firstId:t,updateResult:d.data}),process.exit(1)),(null===(p=d.data)||void 0===p?void 0:p[0].value)!==u&&(console.log({firstItem:null===(f=d.data)||void 0===f?void 0:f[0]},"newValue should be",u),process.exit(1)),[4/*yield*/,db.get("KeyValueMarkdownTestModel")];case 8:return c=h.sent(),console.log({getResult4:c}),1!==c.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.upsert("KeyValueMarkdownTestModel",(function(e){return e.id===(0,common_types_1.generateId)()}),(function(e){return generateKvmdInstance()}))];case 9:return i=h.sent(),console.log({upsertResult:i}),[4/*yield*/,db.upsert("KeyValueMarkdownTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e||generateKvmdInstance()),{name:"upsert UPDATED name"})}))];case 10:return g=h.sent(),console.log({upsert2Result:g}),[4/*yield*/,db.get("KeyValueMarkdownTestModel")];case 11:return v=h.sent(),console.log({getResult5:v}),2!==v.length&&(console.log("Invalid length"),process.exit(1)),console.log("Kvmd Test Succeeded!"),[2/*return*/,!0]}}))}))},generateMarkdownInstance=function(){return{age:19,canBeNull:null,id:"wow",markdown:" jaja dit is gewoon markdown \n\n mooi he \n\n # header \n\n test",name:"file name",slug:"file-name",stringA:"A",stringB:"B",stringC:"C",yes:!0,canBeUndefined:void 0}},testMarkdown=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,t,n,o,s,r,l,a,u,d,c,i,g,v,p,f;return __generator(this,(function(h){switch(h.label){case 0:return e=generateMarkdownInstance(),t=e.id,[4/*yield*/,db.set("MarkdownTestModel",[e])];case 1:return n=h.sent(),console.log({setResult:n}),[4/*yield*/,db.get("MarkdownTestModel")];case 2:return o=h.sent(),console.log({getResult:o}),1!==o.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.push("MarkdownTestModel",generateMarkdownInstance())];case 3:return s=h.sent(),console.log({pushResult:s}),[4/*yield*/,db.get("MarkdownTestModel")];case 4:return r=h.sent(),console.log({getResult2:r}),2!==r.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.remove("MarkdownTestModel",(function(e){return e.id!==t}))];case 5:return l=h.sent(),console.log({removeResult:l,firstId:t}),1!==l.amountRemoved&&(console.log("Invalid amount removed"),process.exit(1)),[4/*yield*/,db.get("MarkdownTestModel")];case 6:return a=h.sent(),console.log({getResult3:a}),1!==a.length&&(console.log("Invalid length"),process.exit(1)),u="new value (updated)",[4/*yield*/,db.update("MarkdownTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e),{value:u})}))];case 7:return d=h.sent(),console.log({updateResult:d}),1!==d.rowsUpdated&&(console.log("Invalid rows updated",{firstId:t,updateResult:d.data}),process.exit(1)),(null===(p=d.data)||void 0===p?void 0:p[0].value)!==u&&(console.log({firstItem:null===(f=d.data)||void 0===f?void 0:f[0]},"newValue should be",u),process.exit(1)),[4/*yield*/,db.get("MarkdownTestModel")];case 8:return c=h.sent(),console.log({getResult4:c}),1!==c.length&&(console.log("Invalid length"),process.exit(1)),[4/*yield*/,db.upsert("MarkdownTestModel",(function(e){return e.id===(0,common_types_1.generateId)()}),(function(e){return generateMarkdownInstance()}))];case 9:return i=h.sent(),console.log({upsertResult:i}),[4/*yield*/,db.upsert("MarkdownTestModel",(function(e){return e.id===t}),(function(e){return __assign(__assign({},e||generateMarkdownInstance()),{name:"upsert UPDATED name"})}))];case 10:return g=h.sent(),console.log({upsert2Result:g}),[4/*yield*/,db.get("MarkdownTestModel")];case 11:return v=h.sent(),console.log({getResult5:v}),2!==v.length&&(console.log("Invalid length"),process.exit(1)),console.log("Kvmd Test Succeeded!"),[2/*return*/,!0]}}))}))},test=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,t,n;return __generator(this,(function(o){switch(o.label){case 0:return[4/*yield*/,testCsv()];case 1:return e=o.sent(),[4/*yield*/,testKvmd()];case 2:return t=o.sent(),[4/*yield*/,testMarkdown()];case 3:return n=o.sent(),console.log({csvTestSucceeded:e,kvmdTestSucceeded:t,markdownTestSucceeded:n}),[2/*return*/]}}))}))};test();
//# sourceMappingURL=test.js.map