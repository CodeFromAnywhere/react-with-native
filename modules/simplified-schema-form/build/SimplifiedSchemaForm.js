"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},__assign.apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t);var i=Object.getOwnPropertyDescriptor(r,t);i&&!("get"in i?!r.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,i)}:function(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__awaiter=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(i,a){function u(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}l((n=n.apply(e,r||[])).next())}))},__generator=this&&this.__generator||function(e,r){var t,n,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=r.call(e,u)}catch(e){a=[6,e],n=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},__spreadArray=this&&this.__spreadArray||function(e,r,t){if(t||2===arguments.length)for(var n,i=0,a=r.length;i<a;i++)!n&&i in r||(n||(n=Array.prototype.slice.call(r,0,i)),n[i]=r[i]);return e.concat(n||Array.prototype.slice.call(r))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimplifiedSchemaForm=void 0;var jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),name_conventions_1=require("name-conventions"),pluralize_1=require("pluralize"),writer_input_1=require("writer-input"),react_with_native_1=require("react-with-native"),convert_case_1=require("convert-case"),js_util_1=require("js-util"),react_with_native_form_inputs_1=require("react-with-native-form-inputs"),dynamic_1=__importDefault(require("next/dynamic")),AssetInput=(0,dynamic_1.default)((function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4/*yield*/,Promise.resolve().then((function(){return __importStar(require("react-with-native-form-asset-input"))}))];case 1:return[2/*return*/,e.sent().AssetInput]}}))}))}),{ssr:!1}),schema_util_1=require("schema-util"),name_conventions_2=require("name-conventions"),renderParameterTitle_1=require("./renderParameterTitle"),getReferencedModelDataItem_1=require("./getReferencedModelDataItem"),ObjectForm_1=require("./ObjectForm"),ArrayForm_1=require("./ArrayForm"),ReferenceInput_1=require("./ReferenceInput"),react_with_native_ui_1=require("react-with-native-ui"),SimplifiedSchemaForm=function(e){var r=e.modelName,t=e.itemNameOrId,n=e.id,i=e.onChange,a=e.parameters,u=e.values,o=e.referencableModelData,l=e.projectRelativeStorageFilePath,_=e.parameterNameStack,c=e.isDebug;if((0,react_1.useEffect)((function(){if(!Array.isArray(u)){var e=a.map((function(){}));i(e)}}),[]),!u)return null;
/** helper function to change a single parameter */var s=function(e,r){
// only change the parameter we need to change
var t=u.map((function(t,n){return n===e?r:t}));i(t)},m=a.map((function(e){return e.name})),f=a.map((function(e,a){var f,d,p,v,h;if(e.simplifiedSchema){var g="".concat(n,".").concat(e.name),j=u[a],y={uniqueFieldId:g,fieldName:g},x=(0,name_conventions_2.getAssetInputType)(e.name,null===(f=e.simplifiedSchema)||void 0===f?void 0:f.type);
/**
         * values[index]
         */
// console.log({
//   parameter,
//   assetInputType,
//   projectRelativeStorageFilePath,
// });
if(x&&l){
// Something like: [function-name]-[nested]-[property]-[item-name/id]
var w=__spreadArray(__spreadArray([],_||[],!0),[(0,pluralize_1.singularize)(e.name),t],!1).filter(js_util_1.notEmpty).join("-"),b={modelName:r,defaultAssetName:w,size:"lg",theme:"Outlined",projectRelativeReferencingFilePath:l,attachTokenToFilename:!0,allowMultiple:x.isMultiple,inputTypes:
// NB: many things are omitted here since they're still a work in progress
"asset"===x.type?void 0:"audio"===x.type?["recordAudio","files"]:"file"===x.type?["files"]:"image"===x.type?["camera","files"]:"video"===x.type?["files","recordScreen","recordVideo"]:void 0};return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,renderParameterTitle_1.renderParameterTitle)(e,c),(0,jsx_runtime_1.jsx)(AssetInput,{value:j?(0,js_util_1.makeArray)(j):[],onChange:function(e){s(a,e)},extra:b,
// parameter={parameter}
config:{},fieldName:e.name,uniqueFieldId:e.name})]},g)}
// First, let's see if the parametername is a reference parameter.
var P=(0,getReferencedModelDataItem_1.getReferencedModelDataItem)(e.name,o);
// console.log({ referencedModelDataItem });
if(null==P?void 0:P.isReferenceParameter)return(0,jsx_runtime_1.jsx)(ReferenceInput_1.ReferenceInput,{parameter:e,parameterValue:j,onChangeParameter:function(e){return s(a,e)},referencedModelDataItem:P,defaultInputFields:y,isDebug:c},g);if(!e.isDbModel||!(0,name_conventions_1.isCalculatedParameter)(e.name)){var S=(0,schema_util_1.getPossibleReferenceParameterNames)(e.name);
// NB: if the property has a model reference, we just need the model reference, not the whole model. This is only for retreiving, it's not present in the database. NB: this is also done when simplifying a schema. Adding it here too is kind of unneccessary if you can assume the schemas are correct, so we should probably remove it later!
if(!!!m.find((function(e){return S.includes(e)}))){if("array"===e.simplifiedSchema.type)return(0,jsx_runtime_1.jsx)(ArrayForm_1.ArrayForm,{modelName:r,parameter:e,parameterValue:j,onChangeParameter:function(e){return s(a,e)},
// passing props
itemNameOrId:t,parameterNameStack:_,referencableModelData:o,isDebug:c,id:g,projectRelativeStorageFilePath:l},g);if("object"===e.simplifiedSchema.type)return(0,jsx_runtime_1.jsx)(ObjectForm_1.ObjectForm,{modelName:r,parameter:e,parameterValue:j,onChangeParameter:function(e){return s(a,e)},
// passing props
itemNameOrId:t,parameterNameStack:_,referencableModelData:o,isDebug:c,id:g,projectRelativeStorageFilePath:l},g);if("number"===(null===(d=e.simplifiedSchema)||void 0===d?void 0:d.type)){var D=u[a];return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,renderParameterTitle_1.renderParameterTitle)(e,c),(0,jsx_runtime_1.jsx)(react_with_native_form_inputs_1.NumberInput,__assign({},y,{onChange:function(r){var t=e.required||null!=r?r||0:void 0,n=u.map((function(e,r){
// NB: only change the index we are on
return r===a?t:e}));i(n)},value:D,extra:{},config:{}}))]},g)}if("boolean"===(null===(p=e.simplifiedSchema)||void 0===p?void 0:p.type)){var I=u[a];return(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{children:(0,jsx_runtime_1.jsx)(react_with_native_form_inputs_1.ToggleInput,__assign({},y,{onChange:function(r){var t=u.map((function(t,n){
// NB: only change the index we are on
return n===a?// NB: ony return undefined for an empty string that's not required
e.required||!1!==r?r:void 0:t}));i(t)},value:I||!1,extra:{label:(0,renderParameterTitle_1.renderParameterTitle)(e,c)},config:{}}))},g)}
// NB: only string text left... sometimes it can be markdown though (textArea would be great here)... But we can't see this yet due to indexation
var q=u[a];if(null===(v=e.simplifiedSchema)||void 0===v?void 0:v.enum){var T=function(e){var r=u.map((function(r,t){
// NB: only change the index we are on
return t===a?//   NB: ony return undefined for an empty string that's not required
e||null:r}));i(r)},F=e.simplifiedSchema.enum.map((function(e){return{value:String(e),label:(0,convert_case_1.humanCase)(String(e))}})),O=null===(h=e.simplifiedSchema)||void 0===h?void 0:h.enum[0],A=O?String(O):null;
// NB: we are changing the state here to set the enum to the first value, if it's not specified
void 0===q&&T(A);var N=q||A,M=F.find((function(e){return e.value===N}));return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,renderParameterTitle_1.renderParameterTitle)(e,c),(0,jsx_runtime_1.jsx)(react_with_native_form_inputs_1.SelectInput,__assign({},y,{onChange:function(e){return T((null==e?void 0:e.value)||null)},value:M,extra:{options:F,autoSuggest:F.length>10},config:{}}))]},g)}var R=function(r){var t=u.map((function(t,n){
// NB: only change the index we are on
return n===a?//   NB: ony return undefined for an empty string that's not required
e.required||0!==r.length?r:void 0:t}));i(t)};if(name_conventions_1.markdownTextParameterNames.includes(e.name))return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,renderParameterTitle_1.renderParameterTitle)(e,c),(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"w-full h-[300px]"},{children:(0,jsx_runtime_1.jsx)(writer_input_1.WriterInput,{className:"".concat(react_with_native_ui_1.UI.bareInput," bg-white h-[300px]"),value:q||"",onChange:R,hideButtons:!0,initialWriterView:"edit",type:"markdown",projectRelativeFilePath:l})}))]},g);var C=name_conventions_1.passwordTextParameterNames.includes(e.name)?react_with_native_form_inputs_1.PasswordInput:react_with_native_form_inputs_1.TextInput;return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,renderParameterTitle_1.renderParameterTitle)(e,c),(0,jsx_runtime_1.jsx)(C,__assign({},y,{onChange:R,value:q||"",extra:{},config:{}}))]},g)}}}})).filter(js_util_1.notEmpty);return(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{children:f})};
// modules
exports.SimplifiedSchemaForm=SimplifiedSchemaForm;
//# sourceMappingURL=SimplifiedSchemaForm.js.map