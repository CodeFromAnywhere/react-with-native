"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOperationClassification=exports.isUiOperation=exports.tsconfigCompilesEsm=exports.packageCompilesTs=void 0;var code_types_1=require("code-types"),fs_util_1=require("fs-util"),read_json_file_1=require("read-json-file"),try_parse_json_1=require("try-parse-json"),hasDependency_1=require("./hasDependency"),isOperation_1=require("./isOperation"),packageCompilesTs=function(e){return!!(null==e?void 0:e.main)&&e.main.startsWith("src/")&&(e.main.endsWith(".ts")||e.main.endsWith(".tsx"))};exports.packageCompilesTs=packageCompilesTs;var tsconfigCompilesEsm=function(e){return!!e.compilerOptions.module&&!!e.compilerOptions.moduleResolution&&e.compilerOptions.module!==code_types_1.ModuleKind.CommonJS&&e.compilerOptions.moduleResolution!==code_types_1.ModuleResolutionKind.Classic};exports.tsconfigCompilesEsm=tsconfigCompilesEsm;var isUiOperation=function(e,s){var i,o=!!s&&((0,hasDependency_1.hasDependency)(s,"react")||(0,hasDependency_1.hasDependency)(s,"react-native")||(0,hasDependency_1.hasDependency)(s,"next")||(0,hasDependency_1.hasDependency)(s,"expo")),n=!!(null===(i=null==e?void 0:e.compilerOptions)||void 0===i?void 0:i.jsx);return o||n};exports.isUiOperation=isUiOperation;
/**
 * Returns `OperationClassification` if it's an operation, or undefined if it's not
 *
 * NB: don't confuse this with `ImportClassification`
 */
var getOperationClassification=function(e){var s;if(void 0===e&&(console.log("Incorrect type at getOperationClassification"),process.exit(1)),(0,isOperation_1.isOperation)(e)){var i=fs_util_1.path.join(e,"package.json"),o=(0,try_parse_json_1.tryParseJson)(fs_util_1.fs.readFileSync(i,"utf8")),n=fs_util_1.path.join(e,"tsconfig.json"),t=(0,read_json_file_1.readJsonFileSync)(n);if(t&&o&&!o.workspaces){var r=fs_util_1.path.join(e,"next.config.js");if(fs_util_1.fs.existsSync(r))return"ui-web";var a=fs_util_1.path.join(e,"app.json");if(fs_util_1.fs.existsSync(a))return"ui-app";var p=(0,exports.packageCompilesTs)(o),c=(0,exports.tsconfigCompilesEsm)(t)?"esm":p?"ts":"cjs";return(0,exports.isUiOperation)(t,o)?"ui-".concat(c):(0,hasDependency_1.hasDependency)(o,"@types/node")?(null===(s=o.operation)||void 0===s?void 0:s.isNodeServer)?"server-cjs":"node-".concat(c):c}}};exports.getOperationClassification=getOperationClassification;
//# sourceMappingURL=getOperationClassification.js.map