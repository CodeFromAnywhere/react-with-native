"use strict";var __spreadArray=this&&this.__spreadArray||function(e,s,n){if(n||2===arguments.length)for(var r,t=0,i=s.length;t<i;t++)!r&&t in s||(r||(r=Array.prototype.slice.call(s,0,t)),r[t]=s[t]);return e.concat(r||Array.prototype.slice.call(s))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOperationClassification=exports.hasDependency=exports.getAllPackageJsonDependencies=void 0;var fs_util_1=require("fs-util"),code_types_1=require("code-types"),try_parse_json_1=require("try-parse-json"),isOperation_1=require("./isOperation"),read_json_file_1=require("read-json-file"),getAllPackageJsonDependencies=function(e){var s=e.dependencies?Object.keys(e.dependencies):[],n=e.devDependencies?Object.keys(e.devDependencies):[],r=e.peerDependencies?Object.keys(e.peerDependencies):[];return __spreadArray(__spreadArray(__spreadArray([],s,!0),n,!0),r,!0)};exports.getAllPackageJsonDependencies=getAllPackageJsonDependencies;var hasDependency=function(e,s){return(0,exports.getAllPackageJsonDependencies)(e).includes(s)};exports.hasDependency=hasDependency;
/**
 * Returns OperationClassification if it's an operation, or undefined if it's not
 *
 * NB: don't confuse this with ProjectType or ImportClassification
 */
var getOperationClassification=function(e){if(void 0===e&&(console.log("Incorrect type at getOperationClassification"),process.exit(1)),(0,isOperation_1.isOperation)(e)){var s=fs_util_1.path.join(e,"package.json"),n=(0,try_parse_json_1.tryParseJson)(fs_util_1.fs.readFileSync(s,"utf8")),r=fs_util_1.path.join(e,"tsconfig.json"),t=(0,read_json_file_1.readJsonFileSync)(r);if(t&&n&&!n.workspaces){var i=fs_util_1.path.join(e,"next.config.js");if(fs_util_1.fs.existsSync(i))return"web";var o=fs_util_1.path.join(e,"app.json");if(fs_util_1.fs.existsSync(o))return"app";var a=!!(null==n?void 0:n.main)&&n.main.startsWith("src/")&&(n.main.endsWith(".ts")||n.main.endsWith(".tsx"));if(!!n&&((0,exports.hasDependency)(n,"react")||(0,exports.hasDependency)(n,"react-native")||(0,exports.hasDependency)(n,"next")||(0,exports.hasDependency)(n,"expo")))return t.compilerOptions.module&&t.compilerOptions.moduleResolution&&t.compilerOptions.module!==code_types_1.ModuleKind.CommonJS&&t.compilerOptions.moduleResolution!==code_types_1.ModuleResolutionKind.Classic?"ui-esm":a?"ui-es6":"ui-es5";var p=!!n&&(0,exports.hasDependency)(n,"express"),c=!!n&&(0,exports.hasDependency)(n,"server");return p||c?"server":a?"ts":(0,exports.hasDependency)(n,"@types/node")?"node":"js"}}};exports.getOperationClassification=getOperationClassification;
//# sourceMappingURL=getOperationClassification.js.map